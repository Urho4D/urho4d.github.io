<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width" name="viewport"/>
  <title>
   Crowdmanager navigation makes an inexplicable turn after reaching the position
  </title>
  <link href="../../../archived.css" rel="stylesheet"/>
  <script type="text/x-mathjax-config">
   MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\\\(','\\\\)']]}});
  </script>
  <script async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript">
  </script>
 </head>
 <body>
  <header class="header">
   <div class="title-span">
    <a href="../../../">
     <img alt="Urho3D" height="40" id="site-logo" src="../../../images/site-logo.png"/>
    </a>
   </div>
  </header>
  <div class="main">
   <div class="archive-span">
    Archive 19/01/2023.
   </div>
   <h1 class="topic-title">
    Crowdmanager navigation makes an inexplicable turn after reaching the position
   </h1>
   <div class="post_container">
    <div class="avatar_container">
     <img class="avatar" src="../../../images/a09cdd53205e2cdfa1a11761ba907add5971776cae4decaa5cb80bc3991981b3.png"/>
    </div>
    <div class="post">
     <div class="user_name">
      tianlv777
     </div>
     <div class="post_content">
      <p>
       Crowdmanager navigation makes an inexplicable turn after reaching the position
      </p>
     </div>
    </div>
   </div>
   <div class="post_container">
    <div class="avatar_container">
     <img class="avatar" src="../../../images/a09cdd53205e2cdfa1a11761ba907add5971776cae4decaa5cb80bc3991981b3.png"/>
    </div>
    <div class="post">
     <div class="user_name">
      tianlv777
     </div>
     <div class="post_content">
      <p>
       <div class="lightbox-wrapper">
        <a class="lightbox" data-download-href="/uploads/short-url/fdazDpE87XHxZsTqXKsGoNoKA0A.jpeg?dl=1" href="https://global.discourse-cdn.com/standard17/uploads/urho3d/original/2X/6/6a9dbe37c9601bfddbeb48cd848f855ca1b751a4.jpeg" rel="noopener nofollow ugc" title="6JJN~T~{VZR763A`%YWMFFW">
         <img alt="6JJN~T~{VZR763A`%YWMFFW" data-base62-sha1="fdazDpE87XHxZsTqXKsGoNoKA0A" data-small-upload="https://global.discourse-cdn.com/standard17/uploads/urho3d/optimized/2X/6/6a9dbe37c9601bfddbeb48cd848f855ca1b751a4_2_10x10.png" height="484" src="../../../images/4993843863646e9fdcfee7ec70cff664c77c3233a71cc768576eed94b2e03ee2.jpeg" width="690"/>
         <div class="meta">
          <svg aria-hidden="true" class="fa d-icon d-icon-far-image svg-icon">
           <use href="#far-image">
           </use>
          </svg>
          <span class="filename">
           6JJN~T~{VZR763A`%YWMFFW
          </span>
          <span class="informations">
           875×614 114 KB
          </span>
          <svg aria-hidden="true" class="fa d-icon d-icon-discourse-expand svg-icon">
           <use href="#discourse-expand">
           </use>
          </svg>
         </div>
        </a>
       </div>
      </p>
     </div>
    </div>
   </div>
   <div class="post_container">
    <div class="avatar_container">
     <img class="avatar" src="../../../images/a09cdd53205e2cdfa1a11761ba907add5971776cae4decaa5cb80bc3991981b3.png"/>
    </div>
    <div class="post">
     <div class="user_name">
      tianlv777
     </div>
     <div class="post_content">
      <p>
       <div class="lightbox-wrapper">
        <a class="lightbox" data-download-href="/uploads/short-url/l94b2ZYhxAfAtjcOLaXPVbw0r1E.jpeg?dl=1" href="https://global.discourse-cdn.com/standard17/uploads/urho3d/original/2X/9/94340c514c824d18dac0d5bde989d7f711577a32.jpeg" rel="noopener nofollow ugc" title="J_P~%WWNUM%1I`1GVQ2_B">
         <img alt="J_P~%WWNUM%1I`1GVQ2_B" data-base62-sha1="l94b2ZYhxAfAtjcOLaXPVbw0r1E" data-small-upload="https://global.discourse-cdn.com/standard17/uploads/urho3d/optimized/2X/9/94340c514c824d18dac0d5bde989d7f711577a32_2_10x10.png" height="432" src="../../../images/2f1a7355b95703893984e51537be2bc226f518ce11b30dac833c8834405c65f4.jpeg" width="690"/>
         <div class="meta">
          <svg aria-hidden="true" class="fa d-icon d-icon-far-image svg-icon">
           <use href="#far-image">
           </use>
          </svg>
          <span class="filename">
           J_P~%WWNUM%1I`1GVQ2_B
          </span>
          <span class="informations">
           974×610 126 KB
          </span>
          <svg aria-hidden="true" class="fa d-icon d-icon-discourse-expand svg-icon">
           <use href="#discourse-expand">
           </use>
          </svg>
         </div>
        </a>
       </div>
      </p>
     </div>
    </div>
   </div>
   <div class="post_container">
    <div class="avatar_container">
     <img class="avatar" src="../../../images/15ec239d285c7ed0e587423843143e7382a3233e3f46ccb5ef7fb0e41eadd119.png"/>
    </div>
    <div class="post">
     <div class="user_name">
      Nerrik
     </div>
     <div class="post_content">
      <p>
       “Arrived” with crowdmanager can be a little unreliable and works other than expected.
       <br/>
       For example depending on the speed the agent can overshoot the target and then make a turn back. So i check the agent distance to the target for my self and reset the target shortly before the agent arrives manually.
      </p>
     </div>
    </div>
   </div>
   <div class="post_container">
    <div class="avatar_container">
     <img class="avatar" src="../../../images/15ec239d285c7ed0e587423843143e7382a3233e3f46ccb5ef7fb0e41eadd119.png"/>
    </div>
    <div class="post">
     <div class="user_name">
      Nerrik
     </div>
     <div class="post_content">
      <p>
       at the HandleCrowdAgentReposition event function
      </p>
      <pre><code class="lang-auto">float arrived = 4.5f;
if ((Vector3(agent-&gt;GetPosition().x_, agent-&gt;GetPosition().y_, agent-&gt;GetPosition().z_) - Vector3(agent-&gt;GetTargetPosition().x_, agent-&gt;GetTargetPosition().y_, agent-&gt;GetTargetPosition().z_)).Length() &lt; arrived)
{
   scenen-&gt;GetComponent&lt;CrowdManager&gt;()-&gt;ResetCrowdTarget(agentnode);
}
</code></pre>
      <p>
       In my project i replaced the agent-&gt;GetPosition().y_ and agent-&gt;GetTargetPosition().y_ with 0.0f to check only the xz distance for more force at gradients, but i dont have overlapping navmeshes.
      </p>
     </div>
    </div>
   </div>
   <div class="post_container">
    <div class="avatar_container">
     <img class="avatar" src="../../../images/bcef716f49982f4e1200d090926926c0d935c6ce1754ffa612f3eef56f7e36b6.png"/>
    </div>
    <div class="post">
     <div class="user_name">
      JSandusky
     </div>
     <div class="post_content">
      <p>
       IIRC as an agent arrives things can get a bit bonkers. Is the vector it ends up facing perhaps a “
       <em>
        natural
       </em>
       ” vector like +X or so on? So many things can go wrong there at the end.
      </p>
      <p>
       While a number of people have contributed to making the detour stuff happen (
       <span class="mention">
        @scorvi
       </span>
       <span class="mention">
        @JTippetts
       </span>
       <span class="mention">
        @cadaver
       </span>
       and myself [I think
       <span class="mention">
        @Eugene
       </span>
       and
       <span class="mention">
        @weitjong
       </span>
       as well plus some others here and there]) it’s best to consider the the navigation and crowd handling to be a baseline you can start with rather than an out of the box solution so things that one could call a hack (like
       <span class="mention">
        @Nerrik
       </span>
       ’s solution, which should really be a modification inside of detour as a threshold) are to be expected necessities to some degree.
      </p>
      <p>
       Expect to code, navigation ultimately gets project specific on a long enough timeline and some features like off-mesh connections are only handled to the bare minimum by what’s there (there are no assumptions we could make … is the offmesh connection a teleporter? a ladder? a wall climb? leap over a gap?). So that sort of work is ultimately on the end-user.
      </p>
     </div>
    </div>
   </div>
   <div class="post_container">
    <div class="avatar_container">
     <img class="avatar" src="../../../images/a09cdd53205e2cdfa1a11761ba907add5971776cae4decaa5cb80bc3991981b3.png"/>
    </div>
    <div class="post">
     <div class="user_name">
      tianlv777
     </div>
     <div class="post_content">
      <p>
       Em I’m very skeptical about the performance of crowdagent. In fact, I want to make a tower defense game, like war3 TD（Tower defense） map. But if there are 1000 units running in the map, will it get stuck in the sky?
      </p>
     </div>
    </div>
   </div>
   <div class="post_container">
    <div class="avatar_container">
     <img class="avatar" src="../../../images/a09cdd53205e2cdfa1a11761ba907add5971776cae4decaa5cb80bc3991981b3.png"/>
    </div>
    <div class="post">
     <div class="user_name">
      tianlv777
     </div>
     <div class="post_content">
      <p>
       Yes, if I insist to create a  tower defense game, I think I should write the navigation logic myself, so that thousands of units can run to the destination on the map.not use crowdmanager.
      </p>
     </div>
    </div>
   </div>
   <div class="post_container">
    <div class="avatar_container">
     <img class="avatar" src="../../../images/bcef716f49982f4e1200d090926926c0d935c6ce1754ffa612f3eef56f7e36b6.png"/>
    </div>
    <div class="post">
     <div class="user_name">
      JSandusky
     </div>
     <div class="post_content">
      <p>
       Safely, the CrowdManager as it is written caps out at about 200 units (it can do more depending on hardware, but this is the safe range). DetourCrowd can handle thousands, but how it’s wrapped in Urho raises tons of events for every CrowdAgent so if you want to break that 200 agent safe limit you need to switch to a DOD approach and raise events for agents in bulk rather than per agent.
      </p>
      <p>
       Crowds quickly saturate event signaling overhead as well as script overhead if using Angelscript/Lua responding to those events.
      </p>
      <p>
       DOD’ing crowds should get you over the 1000 mark safely though but it’s not a bad decision to do something else if you know your constraints.
      </p>
     </div>
    </div>
   </div>
  </div>
 </body>
</html>