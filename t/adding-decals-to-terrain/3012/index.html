<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width" name="viewport"/>
  <title>
   Adding decals to terrain
  </title>
  <link href="../../../archived.css" rel="stylesheet"/>
  <script type="text/x-mathjax-config">
   MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\\\(','\\\\)']]}});
  </script>
  <script async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript">
  </script>
 </head>
 <body>
  <header class="header">
   <div class="title-span">
    <a href="../../../">
     <img alt="Urho3D" height="40" id="site-logo" src="../../../images/site-logo.png"/>
    </a>
   </div>
  </header>
  <div class="main">
   <div class="archive-span">
    Archive 19/01/2023.
   </div>
   <h1 class="topic-title">
    Adding decals to terrain
   </h1>
   <div class="post_container">
    <div class="avatar_container">
     <img class="avatar" src="../../../images/28ebc440ecd4098f2a6ad505cdc9ec368de1a0cd2616ecbd951089089330fbd9.png"/>
    </div>
    <div class="post">
     <div class="user_name">
      slapin
     </div>
     <div class="post_content">
      <p>
       Hi, all!
      </p>
      <p>
       I need to add decal to terrain at
       <span class="bbcode-i">
        Vector3 pos
       </span>
       location and
       <span class="bbcode-i">
        Vector3 normal
       </span>
       .
       <br/>
       How can I
      </p>
      <ol>
       <li>
        <p>
         Find closest terrain patch to
         <span class="bbcode-b">
          pos
         </span>
         and use it as drawable. is there some way?
         <br/>
         I don’t want to use raycast as I already know the location.
        </p>
       </li>
       <li>
        <p>
         Find the rotation from normal vector.
        </p>
       </li>
      </ol>
     </div>
    </div>
   </div>
   <div class="post_container">
    <div class="avatar_container">
     <img class="avatar" src="../../../images/90c37cf62485b050a630164fc2236ee64c63407f82efabaceb8c13fef5f2012d.png"/>
    </div>
    <div class="post">
     <div class="user_name">
      George1
     </div>
     <div class="post_content">
      <p>
       I think you need to use the search function. I think most of the questions you raised existed in the forum.
       <br/>
       There is a decal example in the lib.
       <br/>
       I remember there are a few other solutions including a car wheel trace mark kindly shared by a member a year or two ago.
       <br/>
       Also see the basic effect posted by Lumak. I believed it has decal effect in there.
      </p>
      <p>
       Best
      </p>
     </div>
    </div>
   </div>
   <div class="post_container">
    <div class="avatar_container">
     <img class="avatar" src="../../../images/28ebc440ecd4098f2a6ad505cdc9ec368de1a0cd2616ecbd951089089330fbd9.png"/>
    </div>
    <div class="post">
     <div class="user_name">
      slapin
     </div>
     <div class="post_content">
      <p>
       Decal example use Raycast which provides the Drawable.
       <br/>
       And there’s no decal examples I am aware of on the forum.
      </p>
      <p>
       as for Lumak’s code, he creates geometry, not uses decals in offroad vehicle demo.
      </p>
     </div>
    </div>
   </div>
   <div class="post_container">
    <div class="avatar_container">
     <img class="avatar" src="../../../images/55a28ac655e792ddc5641665e82bbc3cd322414b90de6ccf16537644a3e53276.png"/>
    </div>
    <div class="post">
     <div class="user_name">
      jmiller
     </div>
     <div class="post_content">
      <p>
       George1 refers to a decal example in the lib, here:
       <br/>
       <a href="https://github.com/urho3d/Urho3D/tree/master/Source/Samples/08_Decals">
        https://github.com/urho3d/Urho3D/tree/master/Source/Samples/08_Decals
       </a>
      </p>
      <p>
       If you only want to find the nearest TerrainPatch, you could calc that using the Terrain API (*possibly, depending; or other Drawable methods):
       <br/>
       <a href="https://github.com/urho3d/Urho3D/blob/master/Source/Urho3D/Graphics/Terrain.h">
        https://github.com/urho3d/Urho3D/blob/master/Source/Urho3D/Graphics/Terrain.h
       </a>
      </p>
     </div>
    </div>
   </div>
   <div class="post_container">
    <div class="avatar_container">
     <img class="avatar" src="../../../images/28ebc440ecd4098f2a6ad505cdc9ec368de1a0cd2616ecbd951089089330fbd9.png"/>
    </div>
    <div class="post">
     <div class="user_name">
      slapin
     </div>
     <div class="post_content">
      <p>
       <span class="mention">
        @jmiller
       </span>
       would you please read what I write before answering?
       <img alt=":slight_smile:" class="emoji" src="../../../images/8a8941f0486df9dda1e89ec988e1591cf959e1ea7809a249dc2decb694b30a6c.png" title=":slight_smile:"/>
      </p>
      <p>
       I wrote exactly about 08_Decals and that it uses Raycast to get Drawable.
      </p>
      <p>
       About terrain API - it is not obvoius how to get TerrainPatch closest to a point,
       <br/>
       so I still wait for help with this.
      </p>
     </div>
    </div>
   </div>
   <div class="post_container">
    <div class="avatar_container">
     <img class="avatar" src="../../../images/55a28ac655e792ddc5641665e82bbc3cd322414b90de6ccf16537644a3e53276.png"/>
    </div>
    <div class="post">
     <div class="user_name">
      jmiller
     </div>
     <div class="post_content">
      <p>
       My bad – I was tired and completely missed your first sentence.
       <img alt=":slight_smile:" class="emoji" src="../../../images/8a8941f0486df9dda1e89ec988e1591cf959e1ea7809a249dc2decb694b30a6c.png" title=":slight_smile:"/>
      </p>
      <p>
       As an example of ‘other Drawable methods’: could iterate patches and use their Drawable::GetWorldBoundingBox().Center() perhaps?
      </p>
      <p>
       By ‘calc’, I was thinking of a simpler 2D method that may or may not be suitable. by analogy: “given the position of a grid (terrain), and the grid square (patch) size, find which grid coord a point falls in”.
      </p>
     </div>
    </div>
   </div>
   <div class="post_container">
    <div class="avatar_container">
     <img class="avatar" src="../../../images/b8f5dad81b656072038634f7e88edcb9a54ec3432d6d48dbaba8878d623899bd.png"/>
    </div>
    <div class="post">
     <div class="user_name">
      Dave82
     </div>
     <div class="post_content">
      <aside class="quote no-group" data-post="1" data-topic="3012" data-username="slapin">
       <div class="title">
        <div class="quote-controls">
        </div>
        <img alt="" class="avatar" height="20" src="../../../images/237961ae9435b764c47cf0017625ceef2da2dad7dd8dea88e7197aecc4daca40.png" width="20"/>
        slapin:
       </div>
       <blockquote>
        <p>
         Find the rotation from normal vector
        </p>
       </blockquote>
      </aside>
      <p>
       If you know the normal vector and the position , you can get a rotation vector using a vector function from irrlicht :
      </p>
      <p>
       [CODE]
       <br/>
       Vector3 Vector3::EulerFromNormal()
       <br/>
       {
       <br/>
       Vector3 angle;
       <br/>
       angle.y_ = (atan2(x_ , z_) * :M_RADTODEG);
       <br/>
       if (angle.y_ &lt; 0)  angle.y_ += 360;
       <br/>
       if (angle.y_ &gt;= 360)  angle.y_ -= 360;
      </p>
      <pre><code>float z1 = sqrt(x_ * x_ + z_ * z_);
    angle.x_ = (atan2(z1, y_) * M_RADTODEG - 90.0f);

    if (angle.x_ &lt; 0)  angle.x_ += 360;
    if (angle.x_ &gt;= 360) angle.x_ -= 360;

    return angle;
</code></pre>
      <p>
       }[/CODE]
      </p>
      <p>
       Please note : Depending on your culling (CW , CCW) you may need to negate the normal to get the correct rotation.
       <br/>
       Build a Quaternion using the returned vector (Quaternion rot(returned.x_ , returned,y_ , returned.z_);
      </p>
     </div>
    </div>
   </div>
   <div class="post_container">
    <div class="avatar_container">
     <img class="avatar" src="../../../images/28ebc440ecd4098f2a6ad505cdc9ec368de1a0cd2616ecbd951089089330fbd9.png"/>
    </div>
    <div class="post">
     <div class="user_name">
      slapin
     </div>
     <div class="post_content">
      <p>
       <span class="mention">
        @jmiller
       </span>
       - I know I can get height on the terrein in any point, can’t this be converted to patch somehow?
       <br/>
       the iteratiom method is last resort, it is very, very slow.
       <br/>
       About 2D - one can get texture coordinate too. I don’t understand why there’s no easy Drawable access
       <img alt=":frowning:" class="emoji" src="../../../images/f52368fabff51bf20b9b2a7726cfecb3ca01ecdec8d99f872cca862812b131a7.png" title=":frowning:"/>
      </p>
     </div>
    </div>
   </div>
  </div>
 </body>
</html>